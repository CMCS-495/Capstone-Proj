{# templates/settings.html #}
{% extends 'base.html' %}

{% block title %}Settings{% endblock %}

{% block content %}
<div class="container">
  <h1>Game Settings</h1>
  <form method="post" action="{{ url_for('settings') }}">
    <label>
      Difficulty:
      <select name="difficulty">
        <option value="Easy"   {% if current=='Easy'   %}selected{% endif %}>Easy</option>
        <option value="Normal" {% if current=='Normal' %}selected{% endif %}>Normal</option>
        <option value="Hard"   {% if current=='Hard'   %}selected{% endif %}>Hard</option>
      </select>
    </label>
    <label style="margin-left:1rem;">
      <input type="checkbox" id="music-toggle" name="music" {% if music_enabled %}checked{% endif %}> Music
    </label>
    <br>
    <label>
      LLM Return Length:
      <input type="number" name="llm_return_length" min="15" max="100" value="{{ llm_length }}">
    </label>
    <label style="margin-left:1rem;">
      <input type="checkbox" name="voice" {% if voice_enabled %}checked{% endif %}> Voice
    </label>
    <br>
    <label>
      Map Size:
      <select name="map_size">
        <option value="Small"  {% if map_size=='Small'  %}selected{% endif %}>Small</option>
        <option value="Medium" {% if map_size=='Medium' %}selected{% endif %}>Medium</option>
        <option value="Large"  {% if map_size=='Large'  %}selected{% endif %}>Large</option>
      </select>
    </label>
    <label style="margin-left:1rem;">
      <input type="checkbox" name="randomize_map" {% if randomize_map %}checked{% endif %}> Randomize Map
    </label>
    <br>
    <label>
      Display Theme:
      <select name="display_theme">
        <option value="Standard" {% if display_theme=='Standard' %}selected{% endif %}>Standard</option>
        <option value="Light"    {% if display_theme=='Light'    %}selected{% endif %}>Light</option>
        <option value="Burnt"    {% if display_theme=='Burnt'    %}selected{% endif %}>Burnt</option>
        <option value="Retro"    {% if display_theme=='Retro'    %}selected{% endif %}>Retro</option>
      </select>
    </label>
    <div class="button-row">
      <button type="submit" class="button">Save Settings</button>
      <a class="button" href="{{ url_for('menu') }}">‚Üê Back</a>
    </div>
  </form>
</div>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const toggle = document.getElementById('music-toggle');
    const stored = localStorage.getItem('bgmEnabled');
    if (stored === null) {
      toggle.checked = {{ 'true' if music_enabled else 'false' }};
    } else {
      toggle.checked = stored !== 'false';
    }
    window.setBgmEnabled(toggle.checked);
    toggle.addEventListener('change', () => {
      window.setBgmEnabled(toggle.checked);
    });
  });
</script>
{% endblock %}
