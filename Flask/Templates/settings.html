{# templates/settings.html #}
{% extends 'base.html' %}

{% block title %}Settings{% endblock %}

{% block content %}
<div class="container">
  <h1>Game Settings</h1>
  <form method="post" action="{{ url_for('settings') }}">
    <ul class="settings-list">
      <li>
        <label>
          Difficulty:
          <span class="tooltip" title="Select the difficulty level for the game.">
            <i class="fa fa-info-circle"></i>
          </span>
          <select name="difficulty">
            <option value="Easy"   {% if current=='Easy'   %}selected{% endif %}>Easy</option>
            <option value="Normal" {% if current=='Normal' %}selected{% endif %}>Normal</option>
            <option value="Hard"   {% if current=='Hard'   %}selected{% endif %}>Hard</option>
          </select>
        </label>
      </li>
      <li>
        <label>
          Music:
          <span class="tooltip" title="Enable or disable background music.">
            <i class="fa fa-info-circle"></i>
          </span>
          <input
            type="checkbox"
            id="music-toggle"
            name="music"
            {% if music_enabled %}checked{% endif %}
            data-music-enabled="{{ music_enabled | tojson }}"
          >
        </label>
      </li>
      <li>
        <label>
          LLM Return Length:
          <span class="tooltip" title="Adjust the length of responses from the language model.">
            <i class="fa fa-info-circle"></i>
          </span>
          <input type="number" name="llm_return_length" min="15" max="100" value="{{ llm_length }}">
        </label>
      </li>
      <li>
        <label>
          Voice:
          <span class="tooltip" title="Enable or disable voice responses.">
            <i class="fa fa-info-circle"></i>
          </span>
          <input type="checkbox" name="voice" {% if voice_enabled %}checked{% endif %}> Voice
        </label>
      </li>
      <li>
        <label>
          Map Size:
          <span class="tooltip" title="Choose the size of the game map.">
            <i class="fa fa-info-circle"></i>
          </span>
          <select name="map_size">
            <option value="Small"  {% if map_size=='Small'  %}selected{% endif %}>Small</option>
            <option value="Medium" {% if map_size=='Medium' %}selected{% endif %}>Medium</option>
            <option value="Large"  {% if map_size=='Large'  %}selected{% endif %}>Large</option>
          </select>
        </label>
      </li>
      <li>
        <label>
          Randomize Map:
          <span class="tooltip" title="Randomize the map layout each time you play.">
            <i class="fa fa-info-circle"></i>
          </span>
          <input type="checkbox" name="randomize_map" {% if randomize_map %}checked{% endif %}> Randomize Map
        </label>
      </li>
      <li>
        <label>
          Display Theme:
          <span class="tooltip" title="Choose the visual theme for the game.">
            <i class="fa fa-info-circle"></i>
          </span>
          <select name="display_theme">
            <option value="Standard" {% if display_theme=='Standard' %}selected{% endif %}>Standard</option>
            <option value="Light"    {% if display_theme=='Light'    %}selected{% endif %}>Light</option>
            <option value="Burnt"    {% if display_theme=='Burnt'    %}selected{% endif %}>Burnt</option>
            <option value="Retro"    {% if display_theme=='Retro'    %}selected{% endif %}>Retro</option>
          </select>
        </label>
      </li>
    </ul>
    <div class="button-row">
      <button type="submit" class="button">Save Settings</button>
      <a class="button" href="{{ url_for('menu') }}">Back</a>
    </div>
  </form>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const toggle = document.getElementById('music-toggle');
    const initial = toggle.dataset.musicEnabled === 'true';
    const stored = localStorage.getItem('bgmEnabled');

    toggle.checked = (stored === null) ? initial : (stored !== 'false');
    window.setBgmEnabled(toggle.checked);

    toggle.addEventListener('change', function() {
      window.setBgmEnabled(toggle.checked);
      localStorage.setItem('bgmEnabled', toggle.checked);
    });
  });
</script>
{% endblock %}
